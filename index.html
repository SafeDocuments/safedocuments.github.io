<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Upload and Embed</title>
</head>
<body>
    <h1>Upload a PDF to Google Drive</h1>
    <input type="file" id="fileInput" accept="application/pdf">
    <button onclick="uploadFile()">Upload</button>
    <div id="pdfViewer" style="margin-top: 20px;">
        <!-- The embedded PDF will appear here -->
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/google-api-javascript-client/1.1.0/gapi.js"></script>
    <script>
        // WARNING: This is for demonstration purposes only.
        // In a real application, never expose your client ID or client secret on the client side.
        const CLIENT_ID = '480657269781-3oo277sppsmm2qj1i7uku5dvfbncghsv.apps.googleusercontent.com';
        const API_KEY = 'YOUR_API_KEY'; // You need to add your API key here
        const FOLDER_ID = '1w17OEokh0z5o6MzXWjOYVUYITkW77Fnh';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                scope: SCOPES
            }).then(function () {
                // Listen for sign-in state changes.
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                // Handle the initial sign-in state.
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            });
        }

        function updateSigninStatus(isSignedIn) {
            if (!isSignedIn) {
                gapi.auth2.getAuthInstance().signIn();
            }
        }

        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            if (fileInput.files.length === 0) {
                alert('Please select a file.');
                return;
            }

            const file = fileInput.files[0];
            const metadata = {
                'name': file.name,
                'mimeType': 'application/pdf',
                'parents': [FOLDER_ID]
            };

            const accessToken = gapi.auth.getToken().access_token;
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', file);

            try {
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: new Headers({ 'Authorization': 'Bearer ' + accessToken }),
                    body: form
                });

                const data = await response.json();
                if (response.ok) {
                    displayPDF(data.id);
                } else {
                    alert('Upload failed.');
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                alert('An error occurred. Please try again.');
            }
        }

        function displayPDF(fileId) {
            const pdfViewer = document.getElementById('pdfViewer');
            const embed = `<embed src="https://drive.google.com/file/d/${fileId}/preview" type="application/pdf" width="600" height="500">`;
            pdfViewer.innerHTML = embed;
        }
    </script>
    <script async defer src="https://apis.google.com/js/api.js" onload="handleClientLoad()"></script>
</body>
</html>
